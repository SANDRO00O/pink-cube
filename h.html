<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø© - DeepSeek API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --grid-size: 10;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }

        .info-panel {
            background: rgba(44, 62, 80, 0.8);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .info-panel h2 {
            color: var(--warning);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--warning);
        }

        .api-info {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .api-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .game-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .game-board {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(var(--grid-size), 1fr);
            grid-template-rows: repeat(var(--grid-size), 1fr);
            gap: 4px;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1/1;
            background: #2c3e50;
            border-radius: 8px;
            padding: 10px;
        }

        .game__cell {
            background: #34495e;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
        }

        .game__cell--rock {
            background: #7f8c8d;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .game__cell--lava {
            background: #e74c3c;
            animation: lava 2s infinite;
        }

        @keyframes lava {
            0% { background: #e74c3c; }
            50% { background: #c0392b; }
            100% { background: #e74c3c; }
        }

        .game__cell--stop {
            background: #f1c40f;
        }

        .game__cell--end {
            background: #2ecc71;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .game__player {
            grid-area: var(--positionTop) / var(--positionLeft) / span 1 / span 1;
            background: #3498db;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .game-controls {
            display: grid;
            grid-template-areas:
                ". top ."
                "left . right"
                ". bottom .";
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            background: rgba(52, 152, 219, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .control-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        #top {
            grid-area: top;
        }

        #left {
            grid-area: left;
        }

        #right {
            grid-area: right;
        }

        #bottom {
            grid-area: bottom;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .instructions h2 {
            color: var(--warning);
            margin-bottom: 15px;
        }

        .instructions ul {
            padding-right: 20px;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 10px;
        }

        .api-response {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .highlight {
            color: #f1c40f;
            font-weight: bold;
        }

        .success {
            color: #2ecc71;
        }

        .error {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ù…Ù†Ø²Ù„Ù‚Ø©</h1>
            <p>Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„ØªØ­ÙƒÙ… ÙˆÙˆØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¶Ø±)</p>
        </header>

        <div class="game-container">
            <div class="info-panel">
                <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª DeepSeek API</h2>
                
                <div class="api-info">
                    <h3>ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Gemini API Ø¨Ù€ DeepSeek API</h3>
                    <p>ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø±ØŒ Ù‚Ù…Ù†Ø§ Ø¨Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Gemini API Ø¨Ù€ DeepSeek API Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©.</p>
                    <p>DeepSeek API ÙŠÙˆÙØ± ÙˆØµÙˆÙ„Ø§Ù‹ Ø³Ø±ÙŠØ¹Ù‹Ø§ ÙˆÙ‚ÙˆÙŠÙ‹Ø§ Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©.</p>
                </div>

                <div class="api-info">
                    <h3>ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3>
                    <p>1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API Ù…Ù† Ù…ÙˆÙ‚Ø¹ DeepSeek</p>
                    <p>2. Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø£Ø¯Ù†Ø§Ù‡</p>
                    <p>3. Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                </div>

                <div class="controls">
                    <div style="width: 100%; margin-bottom: 15px;">
                        <label for="api-key-input" class="highlight">Ù…ÙØªØ§Ø­ DeepSeek API:</label>
                        <input type="password" id="api-key-input" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API Ù‡Ù†Ø§" style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; border: none; background: rgba(255,255,255,0.1); color: white;">
                    </div>
                    <button class="btn" id="save-key">Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­</button>
                    <button class="btn btn-success" id="generate">ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</button>
                    <button class="btn btn-danger" id="reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                </div>
            </div>

            <div class="game-area">
                <div class="game-stats">
                    <div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level-text">1</span></div>
                    <div>Ø§Ù„ÙˆÙ‚Øª: <span id="timer">00:00</span></div>
                </div>

                <div class="game-board">
                    <div id="game"></div>
                    <div class="game-controls">
                        <div class="control-btn" id="top">â†‘</div>
                        <div class="control-btn" id="left">â†</div>
                        <div class="control-btn" id="right">â†’</div>
                        <div class="control-btn" id="bottom">â†“</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h2>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
            <ul>
                <li>Ø§Ù„Ù‡Ø¯Ù: Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£Ø®Ø¶Ø± (Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)</li>
                <li>Ø§Ù„ØªØ­ÙƒÙ…: Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø³Ù‡Ù… Ø£Ùˆ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©</li>
                <li>Ø§Ù„Ù„Ø¹Ø¨: Ø³ØªØ³ØªÙ…Ø± Ø¨Ø§Ù„Ø§Ù†Ø²Ù„Ø§Ù‚ Ø­ØªÙ‰ ØªØµØ·Ø¯Ù… Ø¨Ø­Ø§Ø¬Ø²</li>
                <li>Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ØªØ¬Ù†Ø¨ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø­Ù…Ø±Ø§Ø¡ (Ø§Ù„Ø­Ù…Ù…) Ù„Ø£Ù†Ù‡Ø§ ØªÙ‚ØªÙ„Ùƒ</li>
                <li>Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª: Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠØ© (Ø§Ù„ØµØ®ÙˆØ±) ØªÙˆÙ‚Ù Ø­Ø±ÙƒØªÙƒ</li>
                <li>Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙˆÙ‚Ù: Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØµÙØ±Ø§Ø¡ ØªØªÙˆÙ‚Ù Ø¹Ù†Ø¯Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©</li>
            </ul>
        </div>

        <div class="api-response">
            <h3>Ø§Ø³ØªØ¬Ø§Ø¨Ø© DeepSeek API:</h3>
            <p id="api-response-text">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ø³ØªØ¬Ø§Ø¨Ø© API Ø¹Ù†Ø¯ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙŠØ§Øª Ø¬Ø¯ÙŠØ¯Ø©...</p>
        </div>
    </div>

    <script>
        // =================================================================
        // !! Important !!
        // !! Paste your DeepSeek API key here !!
        // !! Get it from: https://platform.deepseek.com/
        // =================================================================
        let API_KEY = "";
        // =================================================================

        const game = document.getElementById("game");
        const levelText = document.getElementById("level-text");
        const timerElement = document.getElementById("timer");
        const apiResponseText = document.getElementById("api-response-text");
        const apiKeyInput = document.getElementById("api-key-input");
        const saveKeyBtn = document.getElementById("save-key");
        const generateBtn = document.getElementById("generate");
        const resetBtn = document.getElementById("reset");
        const topArrow = document.getElementById("top");
        const leftArrow = document.getElementById("left");
        const rightArrow = document.getElementById("right");
        const bottomArrow = document.getElementById("bottom");

        const player = document.createElement("div");
        player.classList.add("game__player");
        player.textContent = "P";

        let level = 0;
        let width = 29;
        const seeb2ase = [
            ["o---e"]
        ];
        const seebase = [
            ["ox---", "---xe"],
            ["ox---", "---xe", "--xxx"],
            ["o--xx", "x--xe", "--x--", "-----", "-----"],
            ["e-xx-", "x--xx", "--xo-", "-x---", "-----"],
            ["xx--e", "---xx", "--xxx", "----x", "-x-ox"],
            ["ox--e", "-x-xx", "---xx", "--xxx", "x---x"],
            ["ox--x", "-x-xe", "---x-", "x----", "x---x"],
            ["ox---", "---xe", "--xxx", "---x-", "x----"],
            ["ox--x", "-----", "x--x-", "x--e-", "x---x"],
            ["ox---", "---x-", "x----", "---xx", "xexxx"],
            ["o-x--", "--x--", "x----", "x--ex", "x--xx"],
            ["ox--x", "---x-", "--e--", "x-x--", "x---x"],
            ["---x---", "-x----e", "--x----", "x------", "o-----x"],
            ["ox----x---", "--------xe", "-----x---x"],
            [
                "xxo---x---",
                "--------x-",
                "-----x----",
                "--x-------",
                "---------e",
                "-x---x----"
            ]
        ];

        const puzzles = [...seeb2ase, ...seebase];
        let initialPosition = [];
        let position = [];
        let end = [];
        let rocks = [];
        let gameInterval;
        let startTime;
        let elapsedTime = 0;

        // Initialize game
        function initGame() {
            clearInterval(gameInterval);
            startTime = Date.now();
            
            gameInterval = setInterval(() => {
                elapsedTime = Date.now() - startTime;
                const minutes = Math.floor(elapsedTime / 60000);
                const seconds = Math.floor((elapsedTime % 60000) / 1000);
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            buildLevel();
            positionPlayer();
            registerArrows();
        }

        const buildLevel = () => {
            if (level === 0) {
                game.classList.add("game--tutorial");
            } else {
                game.classList.remove("game--tutorial");
            }
            
            if (!puzzles[level]) {
                console.error("Error: Trying to build non-existent level. Reverting to level 0.");
                level = 0;
            }
            
            document.body.style.setProperty('--grid-size', puzzles[level][0].length);
            game.innerHTML = "";
            rocks = [];
            
            puzzles[level].forEach((row, rowIndex) => {
                const cells = row.split("");
                cells.forEach((cell, cellIndex) => {
                    const newDiv = document.createElement("div");
                    newDiv.classList.add("game__cell");
                    
                    if (cell === "o") {
                        initialPosition = [cellIndex, rowIndex];
                        position = [cellIndex, rowIndex];
                    } else if (cell === "x") {
                        rocks.push([cellIndex, rowIndex, "rock"]);
                        newDiv.classList.add("game__cell--rock");
                        newDiv.textContent = "ğŸª¨";
                    } else if (cell === "l") {
                        rocks.push([cellIndex, rowIndex, "lava"]);
                        newDiv.classList.add("game__cell--lava");
                        newDiv.textContent = "ğŸŒ‹";
                    } else if (cell === "s") {
                        rocks.push([cellIndex, rowIndex, "stop"]);
                        newDiv.classList.add("game__cell--stop");
                        newDiv.textContent = "â¹ï¸";
                    } else if (cell === "e") {
                        end = [cellIndex, rowIndex];
                        newDiv.classList.add("game__cell--end");
                        newDiv.textContent = "ğŸ";
                    }
                    
                    game.appendChild(newDiv);
                });
            });
            
            game.appendChild(player);
        };

        const positionPlayer = () => {
            player.style.setProperty('--positionLeft', position[0] + 1);
            player.style.setProperty('--positionTop', position[1] + 1);
        };

        const removeEvent = (e) => {
            e.preventDefault();
            e.stopPropagation();
        };

        async function getAIGeneratedLevel() {
            const apiUrl = 'https://api.deepseek.com/chat';
            
            const prompt = `
Ø£Ù†Øª Ù…ØµÙ…Ù… Ù…Ø³ØªÙˆÙŠØ§Øª Ù…Ø­ØªØ±Ù Ù„Ù„Ø¹Ø¨Ø© Ø£Ù„ØºØ§Ø² Ø«Ù†Ø§Ø¦ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯. Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ù…Ø¨Ø¯Ø¹ ÙˆÙØ±ÙŠØ¯ Ù…Ù† Ù†ÙˆØ¹Ù‡ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„Ø­Ù„.

Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰:
- ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ù†ØµÙŠØ©
- ÙƒÙ„ Ø³Ù„Ø³Ù„Ø© ØªÙ…Ø«Ù„ ØµÙÙ‹Ø§ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©
- Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:
  'o': Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  'e': Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
  'x': ØµØ®Ø±Ø© (ØªÙˆÙ‚Ù Ù‚Ø¨Ù„Ù‡Ø§)
  'l': Ø­Ù…Ù… (ØªØ³Ø¨Ø¨ Ø§Ù„Ø®Ø³Ø§Ø±Ø©)
  's': Ù†Ù‚Ø·Ø© ØªÙˆÙ‚Ù (ØªÙˆÙ‚Ù Ø¹Ù„ÙŠÙ‡Ø§)
  '-': Ù…Ø³Ø§Ø­Ø© ÙØ§Ø±ØºØ©

Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:
1. Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø´Ø¨ÙƒØ©: Ù…Ù† 5Ã—5 Ø¥Ù„Ù‰ 10Ã—10
2. ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ø­Ø¯Ø© (o) ÙˆÙ†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© ÙˆØ§Ø­Ø¯Ø© (e)
3. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„Ø§Ù‹ Ù„Ù„Ø­Ù„
4. ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… Ù…Ø¨Ø¯Ø¹Ù‹Ø§ ÙˆÙŠÙ‚Ø¯Ù… ØªØ­Ø¯ÙŠÙ‹Ø§ Ù…Ø¹Ù‚ÙˆÙ„Ø§Ù‹

Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØµØ§Ù„Ø­Ø©:
["o---e"]
["ox---", "---xe"]
["o--xx", "x--xe", "--x--", "-----", "-----"]

Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ù†Ø´Ø¦ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ ÙÙ‚Ø· ÙÙŠ Ø´ÙƒÙ„ Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ù†ØµÙŠØ© Ø¯ÙˆÙ† Ø£ÙŠ Ø´Ø±Ø­ Ø¥Ø¶Ø§ÙÙŠ.
            `;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: 'You are an expert game level designer' },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Request failed');
                }

                const data = await response.json();
                const rawText = data.choices[0].message.content;
                
                // Clean the response and extract the JSON array
                const jsonMatch = rawText.match(/\[[\s\S]*?\]/);
                if (jsonMatch) {
                    const levelArray = JSON.parse(jsonMatch[0]);
                    apiResponseText.innerHTML = `ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­:\n\n<code>${JSON.stringify(levelArray, null, 2)}</code>`;
                    apiResponseText.classList.add("success");
                    apiResponseText.classList.remove("error");
                    return levelArray;
                } else {
                    throw new Error('Failed to parse level from response');
                }
            } catch (error) {
                console.error('Error calling DeepSeek API:', error);
                apiResponseText.innerHTML = `Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${error.message}`;
                apiResponseText.classList.add("error");
                apiResponseText.classList.remove("success");
                return getAIGeneratedLevel();
            }
        }

        

        const winLevel = async () => {
            game.classList.add("game--win");
            document.addEventListener("keydown", removeEvent);
            removeArrowsEvents();
            
            const isLastPredefinedLevel = level >= puzzles.length - 1;
            
            setTimeout(async () => {
                game.classList.remove("game--win");
                
                if (isLastPredefinedLevel) {
                    game.classList.add("game--generating");
                    apiResponseText.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… DeepSeek API...";
                    
                    const newLevel = await getAIGeneratedLevel();
                    puzzles.push(newLevel);
                    
                    game.classList.remove("game--generating");
                }
                
                level = level + 1;
                levelText.innerHTML = level;
                initGame();
                document.removeEventListener("keydown", removeEvent);
            }, 1000);
        };

        const loseLevel = () => {
            game.classList.add("game--lose");
            document.addEventListener("keydown", removeEvent);
            removeArrowsEvents();
            setTimeout(() => {
                game.classList.remove("game--lose");
                position = [...initialPosition];
                positionPlayer();
                document.removeEventListener("keydown", removeEvent);
                registerArrows();
            }, 500);
        };

        const nextLevel = () => {
            if (position[0] === end[0] && position[1] === end[1]) {
                winLevel();
            }
        };

        const movePlayer = (axis, perpendicularAxis, movingForward) => {
            const relevantRocks = rocks
                .filter((rock) => rock[axis] === position[axis])
                .filter((rock) =>
                    movingForward ?
                    rock[perpendicularAxis] > position[perpendicularAxis] :
                    rock[perpendicularAxis] < position[perpendicularAxis]
                );
                
            if (relevantRocks.length) {
                const minmax = movingForward ?
                    Math.min(...relevantRocks.map((rock) => rock[perpendicularAxis])) :
                    Math.max(...relevantRocks.map((rock) => rock[perpendicularAxis]));
                    
                const relevantRock = relevantRocks.find(
                    (rock) => rock[perpendicularAxis] === minmax
                );
                
                if (relevantRock[2] === "rock") {
                    position[perpendicularAxis] = movingForward ? minmax - 1 : minmax + 1;
                } else {
                    position[perpendicularAxis] = minmax;
                    if (relevantRock[2] === "lava") {
                        loseLevel();
                    }
                }
            } else {
                const maxCells =
                    axis === 1 ? puzzles[level][0].length : puzzles[level].length;
                position[perpendicularAxis] = movingForward ? maxCells - 1 : 0;
            }
            
            positionPlayer();
            nextLevel();
        };

        const topFunction = () => movePlayer(0, 1, false);
        const leftFunction = () => movePlayer(1, 0, false);
        const rightFunction = () => movePlayer(1, 0, true);
        const bottomFunction = () => movePlayer(0, 1, true);

        const registerArrows = () => {
            topArrow.addEventListener("click", topFunction);
            leftArrow.addEventListener("click", leftFunction);
            rightArrow.addEventListener("click", rightFunction);
            bottomArrow.addEventListener("click", bottomFunction);
        };

        const removeArrowsEvents = () => {
            topArrow.removeEventListener("click", topFunction);
            leftArrow.removeEventListener("click", leftFunction);
            rightArrow.removeEventListener("click", rightFunction);
            bottomArrow.removeEventListener("click", bottomFunction);
        };

        // Event listeners
        window.addEventListener("keydown", (event) => {
            if (event.key === "ArrowRight") {
                rightFunction();
            } else if (event.key === "ArrowLeft") {
                leftFunction();
            } else if (event.key === "ArrowDown") {
                bottomFunction();
            } else if (event.key === "ArrowUp") {
                topFunction();
            }
        });

        saveKeyBtn.addEventListener("click", () => {
            API_KEY = apiKeyInput.value.trim();
            if (API_KEY) {
                alert("ØªÙ… Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API Ø¨Ù†Ø¬Ø§Ø­!");
            } else {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API ØµØ§Ù„Ø­");
            }
        });

        generateBtn.addEventListener("click", async () => {
            if (!API_KEY) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ DeepSeek API Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }
            
            game.classList.add("game--generating");
            apiResponseText.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… DeepSeek API...";
            
            const newLevel = await getAIGeneratedLevel();
            puzzles.push(newLevel);
            level = puzzles.length - 1;
            levelText.innerHTML = level;
            
            game.classList.remove("game--generating");
            initGame();
        });

        resetBtn.addEventListener("click", () => {
            level = 0;
            levelText.innerHTML = level;
            elapsedTime = 0;
            timerElement.textContent = "00:00";
            initGame();
        });

        // Initialize the game
        initGame();
    </script>
</body>
</html>